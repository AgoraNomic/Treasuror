#!/usr/bin/env ruby

$LOAD_PATH.unshift File.dirname(__FILE__) + "/../lib"

require 'thor'
require 'tmpdir'

require 'treasuror'

class Treasuror::CLI < Thor
	desc "email", "Generate an email with a report."
	def email
		Dir::Tmpname.create(["treasuror", ".eml"]) do |path|
			File.open(path, "w") do |file|
				file.write(Treasuror::Report.email)
			end
			puts path
		end
	end

	desc "report", "Print out a report."
	def report
		puts Treasuror::Report.text_message
	end

	desc "build", "Build the HTML report and current state YAML file"
	def build
		File.open(File.dirname(__FILE__) + "/../index.html", 'w') do |file|
			file.write(Treasuror::Report.html)
		end
		`open #{File.dirname(__FILE__) + "/../index.html"}`
		File.open(File.dirname(__FILE__) + "/../current.yaml", 'w') do |file|
			YAML.dump(Treasuror.current_state, file)
		end
	end
end

Treasuror::CLI.start